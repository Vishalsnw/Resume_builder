name: Fix Invalid Imports

on:
  workflow_dispatch:  # Allows manual triggering

jobs:
  fix-imports:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
      
      - name: Find source directory and fix invalid imports
        run: |
          # First, list the repository structure to understand what we're working with
          echo "Repository structure:"
          ls -la
          
          # Try to find where the source files actually are
          SOURCE_DIRS=$(find . -type d -name "src" -o -name "source" -o -name "app" | grep -v "node_modules")
          echo "Potential source directories found: $SOURCE_DIRS"
          
          if [ -z "$SOURCE_DIRS" ]; then
            echo "No src directory found. Searching for JS/TS files directly..."
            JS_FILES=$(find . -type f \( -name "*.js" -o -name "*.jsx" -o -name "*.ts" -o -name "*.tsx" \) -not -path "*/node_modules/*" -not -path "*/dist/*" -not -path "*/build/*")
          else
            # Process each potential source directory
            for SRC_DIR in $SOURCE_DIRS; do
              echo "Checking source directory: $SRC_DIR"
              JS_FILES=$(find "$SRC_DIR" -type f \( -name "*.js" -o -name "*.jsx" -o -name "*.ts" -o -name "*.tsx" \))
              
              # Process each file in this directory
              for FILE in $JS_FILES; do
                echo "Examining $FILE"
                
                # Create a backup
                cp "$FILE" "${FILE}.bak"
                
                # Fix imports with numbers at start, hyphens, or brackets
                sed -i -E 's/^import[[:space:]]+([0-9]+|.*[-\[\].].*)[[:space:]]+from[[:space:]]+.*$/\/\/ REMOVED INVALID IMPORT/g' "$FILE"
                
                # Check if file was modified
                if ! cmp -s "$FILE" "${FILE}.bak"; then
                  echo "Fixed invalid imports in $FILE"
                fi
                
                # Clean up backup
                rm "${FILE}.bak"
              done
            done
          fi

      - name: Commit changes
        uses: stefanzweifel/git-auto-commit-action@v4
        with:
          commit_message: "Fix invalid import statements"
